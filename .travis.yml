language: cpp
compiler:
  # Comment out for now to keep build matrix small
  #- clang
  - gcc
env:
  global:
    # The Travis Ubuntu Xenial environment we run in currently promises 2 cores,
    # so running lengthy make steps with -j2 is almost certainly a win.
    - MAKEFLAGS=-j2
  matrix:
    # Configurations
    #
    # Each line in the ``env`` section represents a set of environment
    # variables passed to a build configuration
    #
    # Test a mix of llvm versions, a mix of build systems, and a mix of shared vs static library
    # Don't build as a static library with cmake. It risks exceeding the travis memory limit.
    #
    - LLVM_VERSION=8.0.0 BUILD_SYSTEM=MAKE
    - LLVM_VERSION=8.0.0 BUILD_SYSTEM=CMAKE HALIDE_SHARED_LIBRARY=1
    - LLVM_VERSION=7.0.1 BUILD_SYSTEM=MAKE
    - LLVM_VERSION=6.0.1 BUILD_SYSTEM=MAKE
cache: apt ccache
dist: xenial
# Note the commands below are written assuming Ubuntu 16.04LTS
addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - gcc-7
    - g++-7
    - doxygen
    - libpng-dev
install:
  # Make gcc7 the default gcc version
  - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 50
  - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-7 50
  # Download & install the right llvm release.
  - wget https://releases.llvm.org/${LLVM_VERSION}/clang+llvm-${LLVM_VERSION}-x86_64-linux-gnu-ubuntu-16.04.tar.xz
  - tar xvf clang+llvm-${LLVM_VERSION}-x86_64-linux-gnu-ubuntu-16.04.tar.xz
  - sudo mv clang+llvm-${LLVM_VERSION}-x86_64-linux-gnu-ubuntu-16.04 /usr/local/llvm
script:
  - export CXX=g++-7
  - export CC=gcc-7
  - test/scripts/build_travis.sh
